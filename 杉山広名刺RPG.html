<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>æ‰å±±åºƒã®ååˆºRPG</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0b1020; --panel:#0f172a; --ink:#e5e7eb; --muted:#9ca3af;
    --accent:#86efac; --accent2:#60a5fa; --warn:#f472b6; --tile:#111827; --wall:#1f2937;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:radial-gradient(1000px 500px at 0% 0%,#1b2550 0,transparent 60%),var(--bg);
       color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:1100px;margin:auto;padding:16px;display:grid;gap:16px;
        grid-template-columns: 1fr min(380px,46vw);}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
        border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:14px; }
  h1{font-family:"Press Start 2P",monospace; font-size:18px; margin:6px 0 8px}
  p{margin:6px 0} .muted{color:var(--muted)}
  canvas{display:block;border-radius:12px;border:1px solid rgba(255,255,255,.1); background:#0b0f1a}
  .panel h2{margin:.4rem 0;font-size:16px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .btn{appearance:none;border:1px solid rgba(255,255,255,.14); background:#0c1324;color:var(--ink);
       padding:8px 10px;border-radius:10px;cursor:pointer; font-weight:600}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#071019;border:none}
  .badge{display:inline-block;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);
         padding:3px 9px;border-radius:999px;font-size:12px;color:var(--muted)}
  .kbd{font-family:monospace;background:#111827;border:1px solid #1f2937;border-radius:6px;padding:2px 6px}
  .grid{display:grid;grid-template-columns:repeat(3,64px);gap:8px;justify-content:center}
  .padbtn{width:64px;height:64px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0c1324;
          font-size:22px}
  dialog{border:none;border-radius:16px;max-width:min(560px,92vw);padding:16px;background:#0f172a;color:var(--ink)}
  dialog::backdrop{background:rgba(0,0,0,.4)}
  .footer{margin-top:6px;font-size:12px;color:var(--muted);text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <section class="card">
      <h1>å‹‡è€…ã‚ˆã€å›ã¯â€œæ‰å±±åºƒâ€ã¨å‡ºä¼šã£ãŸï¼</h1>
      <p class="muted">çŸ¢å°ã‚­ãƒ¼ / WASD ã§ç§»å‹•ã€‚ã‚¹ãƒãƒ›ã¯ä¸‹ã®ãƒ‘ãƒƒãƒ‰ã§æ“ä½œã€‚<br>
        ã¾ãšã¯ â€œå½¹è·â€ ã‚’é¸ã‚“ã§ã‹ã‚‰é–‹å§‹ã€‚<br>
        <span class="badge">2ã¤ã®ç™ºè¦‹ã‚’é›†ã‚ã‚‹ã¨ãƒãƒ¼ã‚¿ãƒ«è§£æ”¾â†’é€£çµ¡å…ˆã¸</span>
      </p>
      <canvas id="game" width="416" height="416" aria-label="RPGååˆºã®ã‚²ãƒ¼ãƒ ç”»é¢"></canvas>

      <!-- ãƒ¢ãƒã‚¤ãƒ«æ“ä½œãƒ‘ãƒƒãƒ‰ -->
      <div class="grid" aria-label="æ–¹å‘ãƒ‘ãƒƒãƒ‰">
        <button class="padbtn" data-move="up">â¬†ï¸</button>
        <button class="padbtn" data-move="none">ğŸ¯</button>
        <button class="padbtn" data-move="right">â¡ï¸</button>
        <button class="padbtn" data-move="left">â¬…ï¸</button>
        <button class="padbtn" data-move="down">â¬‡ï¸</button>
        <button class="padbtn" data-move="talk">ğŸ’¬</button>
      </div>
    </section>

    <aside class="card panel">
      <h2>å½¹è·ã‚’é¸ã¶</h2>
      <div class="row" id="roleRow">
        <button class="btn" data-role="æ¡ç”¨ãƒ»äººäº‹">ğŸ‘¤ æ¡ç”¨ãƒ»äººäº‹</button>
        <button class="btn" data-role="äº‹æ¥­ãƒ»èµ·æ¥­">ğŸš€ äº‹æ¥­ãƒ»èµ·æ¥­</button>
        <button class="btn" data-role="ç ”ç©¶ãƒ»AI">ğŸ§ª ç ”ç©¶ãƒ»AI</button>
        <button class="btn" data-role="ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ã‚¢ãƒ¼ãƒˆ">ğŸ¨ ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ã‚¢ãƒ¼ãƒˆ</button>
        <button class="btn" data-role="å­¦ç”Ÿãƒ»ãã®ä»–">ğŸ’ å­¦ç”Ÿãƒ»ãã®ä»–</button>
      </div>
      <p class="badge" id="roleHint">æœªé¸æŠ</p>
      <div class="hr"></div>

      <h2>é€²æ—</h2>
      <p>ç™ºè¦‹ï¼š<span id="found">0</span> / 2ã€€|ã€€ãƒãƒ¼ã‚¿ãƒ«ï¼š<span id="portal">ğŸ”’</span></p>
      <p>ãƒ’ãƒ³ãƒˆï¼š<span id="hint" class="muted">ä¸­å¤®ã®â€œHâ€ã«è©±ã—ã‹ã‘ã‚ˆã†ï¼ˆ<span class="kbd">Space</span>ï¼‰</span></p>
      <div class="row">
        <button id="reset" class="btn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
        <button id="contactBtn" class="btn primary" disabled>ğŸ“¨ é€£çµ¡å…ˆ</button>
      </div>
      <p class="footer">Â© Hiro Sugiyama | â€œé¢ç™½ã•â€ã¯çœŸé¢ç›®ã•ã®åˆ¥åã€‚</p>
    </aside>
  </div>

  <!-- ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼šä¼šè©± / é€£çµ¡å…ˆ -->
  <dialog id="dlg">
    <div id="dlgBody"></div>
    <div class="row" style="margin-top:10px">
      <button id="dlgClose" class="btn">OK</button>
    </div>
  </dialog>

<script>
/* =========================
    æœ€å°æ§‹æˆRPGï¼ˆç”»åƒãªã—ï¼‰
   ========================= */
const cvs = document.getElementById('game');
const ctx = cvs.getContext('2d');
const TILE = 32;                   // 1ãƒã‚¹=32px
const W = 13, H = 13;              // 13x13 ã®å°ã•ãªãƒãƒƒãƒ—
const UI = {
  role: document.getElementById('roleHint'),
  found: document.getElementById('found'),
  portal: document.getElementById('portal'),
  hint: document.getElementById('hint'),
  dlg: document.getElementById('dlg'),
  dlgBody: document.getElementById('dlgBody'),
  dlgClose: document.getElementById('dlgClose'),
  contactBtn: document.getElementById('contactBtn')
};

// ===== ãƒãƒƒãƒ—ï¼ˆ#=å£ . =åºŠ H=ãƒ’ãƒ­(è©±ã™) A/B=ç™ºè¦‹ D=ãƒãƒ¼ã‚¿ãƒ« S=é–‹å§‹ä½ç½®ï¼‰ =====
const MAP = [
  "#############",
  "#.....A.....#",
  "#.###...###.#",
  "#.#.......#.#",
  "#.#.###.#.#.#",
  "#...#H#.#...#",
  "#.###.#.###.#",
  "#.....B.....#",
  "#.#.###.###.#",
  "#.#.....D.#.#",
  "#.#####.###.#",
  "#.....S.....#",
  "#############",
];

const state = {
  x: 6, y: 11,      // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæœŸ
  role: null,
  foundA: false,
  foundB: false,
  portalOpen: false
};

// å½¹è·ã”ã¨ã®ä¸€è¨€ï¼ˆä¼šè©±ã«åæ˜ ï¼‰
const roleLines = {
  "æ¡ç”¨ãƒ»äººäº‹": "å†ç¾æ€§/ãƒ­ã‚°é‡è¦–ã€‚å°ã•ãè©¦ã—ã€å­¦ã³ã‚’æ®‹ã™äººã§ã™ã€‚",
  "äº‹æ¥­ãƒ»èµ·æ¥­": "ä»®èª¬â†’MVPâ†’åå¿œâ†’æ¬¡ã®è³­ã‘ã€‚å¸¸è­˜ã‚’åŠæ­©ã‚ºãƒ©ã™ã®ãŒå¾—æ„ã€‚",
  "ç ”ç©¶ãƒ»AI":   "AIã¯å¢—å¹…è£…ç½®ã€‚æ¯”è¼ƒå®Ÿé¨“ã§â€œè¡Œå‹•ã®å·®â€ã‚’è¦‹ã‚‹ã®ãŒå¥½ãã€‚",
  "ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ»ã‚¢ãƒ¼ãƒˆ": "ç¾ä»£ç¾è¡“ãŒå¥½ãã€‚é™ã‹ãªé©šãã‚’ç‰©èªã¨UIã§è¨­è¨ˆã€‚",
  "å­¦ç”Ÿãƒ»ãã®ä»–": "5åˆ†ã§å‹•ãéŠã³ã‚’ã¤ãã‚‹ã€‚ç¥­ã‚Šã®ç«ä»˜ã‘å½¹ã‚¿ã‚¤ãƒ—ã€‚"
};

// ===== å½¹è·é¸æŠ =====
document.getElementById('roleRow').addEventListener('click', e=>{
  if(!e.target.dataset.role) return;
  state.role = e.target.dataset.role;
  UI.role.textContent = "é¸æŠä¸­ï¼š" + state.role;
  tip("Hï¼ˆä¸­å¤®ï¼‰ã«è©±ã—ã‹ã‘ã¦ã¿ã‚ˆã†ã€‚");
  draw();
});

// ===== å…¥åŠ›ï¼ˆPC/Mobileï¼‰ =====
document.addEventListener('keydown', e=>{
  const k = e.key.toLowerCase();
  if(['arrowup','w'].includes(k)) step(0,-1);
  if(['arrowdown','s'].includes(k)) step(0,1);
  if(['arrowleft','a'].includes(k)) step(-1,0);
  if(['arrowright','d'].includes(k)) step(1,0);
  if(k===' '){ talk(); }
});
document.querySelectorAll('.padbtn').forEach(b=>{
  b.addEventListener('click', ()=>{
    const d=b.dataset.move;
    if(d==='up') step(0,-1);
    if(d==='down') step(0,1);
    if(d==='left') step(-1,0);
    if(d==='right') step(1,0);
    if(d==='talk') talk();
  });
});

document.getElementById('reset').onclick = ()=>{ localStorage.removeItem('meishiRPG'); location.reload(); };

// ====== ä¿å­˜/å¾©å…ƒ ======
function save(){
  localStorage.setItem('meishiRPG', JSON.stringify(state));
}
function load(){
  const s = localStorage.getItem('meishiRPG');
  if(!s) return;
  try{
    const d = JSON.parse(s);
    Object.assign(state,d);
  }catch{}
}
load();

// ====== ç§»å‹•ãƒ»è¡çªãƒ»ã‚¤ãƒ™ãƒ³ãƒˆ ======
function tileAt(x,y){ return MAP[y]?.[x] ?? '#'; }
function isWall(x,y){ return tileAt(x,y) === '#'; }

function step(dx,dy){
  const nx = state.x + dx, ny = state.y + dy;
  if(isWall(nx,ny)) return; // å£
  state.x = nx; state.y = ny;
  const t = tileAt(nx,ny);
  if(t==='A' && !state.foundA){ state.foundA=true; toast("ğŸ“— è¦³å¯Ÿãƒãƒ¼ãƒˆã‚’è¦‹ã¤ã‘ãŸ"); }
  if(t==='B' && !state.foundB){ state.foundB=true; toast("ğŸ§© å°ã•ãªã„ãŸãšã‚‰ã®ç¨®ã‚’æ‹¾ã£ãŸ"); }
  if(!state.portalOpen && state.foundA && state.foundB){
    state.portalOpen=true; toast("ğŸ”“ ãƒãƒ¼ã‚¿ãƒ«ãŒèµ·å‹•ã—ãŸï¼");
  }
  if(t==='D' && state.portalOpen){
    openContact();
  }
  draw(); save();
}

function talk(){
  if(tileAt(state.x,state.y)==='H' ||
     Math.abs(state.x-6)+Math.abs(state.y-5)===1){
    const lineRole = state.role ? roleLines[state.role] : "ã¾ãšã¯å³ã®æ¬„ã§â€œå½¹è·â€ã‚’é¸ã‚“ã§ã­ã€‚";
    say(`
      <p><strong>æ‰å±±åºƒ</strong>ï¼ˆæ…¶æ‡‰ãƒ»çµŒæ¸ˆï¼‰ã§ã™ã€‚<br>
      â€œäººã®ç„¡æ„è­˜ã®ãµã‚‹ã¾ã„â€ã‚’è¦³å¯Ÿã—ã¦ã€é™ã‹ã«ã‚ºãƒ©ã™ä»•æ›ã‘ãŒå¥½ãã§ã™ã€‚</p>
      <p class="muted">å¥½ãï¼šç¾ä»£ç¾è¡“ï¼æœ€è¿‘ï¼šAIã¨â€œä¼šè©±â€ã™ã‚‹å®Ÿé¨“</p>
      <p style="margin:.6rem 0 .2rem"><span class="badge">ã‚ãªãŸï¼ˆ${state.role ?? 'æœªé¸æŠ'}ï¼‰å‘ã‘ã®ä¸€è¨€</span></p>
      <p>${lineRole}</p>
      <p>ãƒãƒƒãƒ—å†…ã® <strong>A</strong> ã¨ <strong>B</strong> ã‚’è¦‹ã¤ã‘ã‚‹ã¨ã€<strong>ãƒãƒ¼ã‚¿ãƒ«ï¼ˆDï¼‰</strong>ã‹ã‚‰é€£çµ¡å…ˆã¸è¡Œã‘ã¾ã™ã€‚</p>
    `);
  }else{
    toast("ğŸ’¬ è¿‘ãã«è©±ã™ç›¸æ‰‹ã¯ã„ãªã„");
  }
}

// ====== UIï¼ˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°/ãƒ’ãƒ³ãƒˆï¼‰ ======
function say(html){
  UI.dlgBody.innerHTML = html;
  UI.dlg.showModal();
}
UI.dlgClose.onclick = ()=> UI.dlg.close();

function openContact(){
  UI.contactBtn.disabled = false;
  UI.portal.textContent = "ğŸŸ¢";
  UI.contactBtn.onclick = ()=>{
    say(`
      <h3>ğŸ“¨ é€£çµ¡å…ˆ</h3>
      <ul>
        <li><strong>LINE</strong>ï¼šyour-line-id</li>
        <li><strong>X(Twitter)</strong>ï¼š<a href="https://x.com/yourid" target="_blank">https://x.com/yourid</a></li>
        <li><strong>Instagram</strong>ï¼š<a href="https://instagram.com/yourid" target="_blank">https://instagram.com/yourid</a></li>
        <li><strong>Mail</strong>ï¼šyourname@example.com</li>
        <li><strong>Portfolio</strong>ï¼š<a href="https://yourname.github.io" target="_blank">https://yourname.github.io</a></li>
      </ul>
      <p class="muted">â€œé¢ç™½ã•â€ã¯çœŸé¢ç›®ã•ã®åˆ¥åã€‚ã‚ˆã‘ã‚Œã°ä¸€è¨€ãã ã•ã„ã€‚</p>
    `);
  };
  UI.contactBtn.click(); // åˆå›ã¯è‡ªå‹•ã§é–‹ã
}

function tip(text){ UI.hint.textContent = text; }
function toast(text){ tip(text); }

// ====== æç”» ======
function draw(){
  ctx.clearRect(0,0,cvs.width,cvs.height);
  for(let y=0;y<H;y++){
    for(let x=0;x<W;x++){
      const ch = MAP[y][x];
      // åœ°é¢
      ctx.fillStyle = (x+y)%2 ? "#0e162a" : "#0b1222";
      ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
      // å£
      if(ch==='#'){
        ctx.fillStyle = "#1f2b44";
        ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
      }
      // ç‰¹æ®Šã‚¿ã‚¤ãƒ«
      if(ch==='H'){ drawGlyph(x,y,"H","#facc15"); }           // ãƒ’ãƒ­
      if(ch==='A' && !state.foundA){ drawGlyph(x,y,"A","#86efac"); }
      if(ch==='B' && !state.foundB){ drawGlyph(x,y,"B","#60a5fa"); }
      if(ch==='D'){ drawGlyph(x,y, state.portalOpen?"D":"D", state.portalOpen?"#22d3ee":"#334155"); }
    }
  }
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
  drawPlayer(state.x,state.y);
  // é€²æ—
  UI.found.textContent = (state.foundA?1:0) + (state.foundB?1:0);
  UI.portal.textContent = state.portalOpen ? "ğŸŸ¢" : "ğŸ”’";
}

function drawGlyph(x,y,text,color){
  ctx.fillStyle = color;
  ctx.strokeStyle = "rgba(0,0,0,.35)";
  ctx.lineWidth = 2;
  roundRect(x*TILE+6,y*TILE+6,TILE-12,TILE-12,6,true,false);
  ctx.fillStyle = "#0b1020";
  roundRect(x*TILE+8,y*TILE+8,TILE-16,TILE-16,5,true,false);
  ctx.fillStyle = color;
  ctx.font = "bold 16px 'Press Start 2P',monospace";
  ctx.textAlign="center"; ctx.textBaseline="middle";
  ctx.fillText(text, x*TILE+TILE/2, y*TILE+TILE/2+1);
}

function drawPlayer(x,y){
  ctx.fillStyle = "#e5e7eb";
  ctx.beginPath();
  ctx.arc(x*TILE+16,y*TILE+16,10,0,Math.PI*2);
  ctx.fill();
  ctx.fillStyle = "#0b1020";
  ctx.fillRect(x*TILE+12,y*TILE+12,3,3); // ç›®
  ctx.fillRect(x*TILE+20,y*TILE+12,3,3);
}

function roundRect(x,y,w,h,r,fill,stroke){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  if(fill) ctx.fill(); if(stroke) ctx.stroke();
}

// åˆæœŸåŒ–ï¼šStartä½ç½®ï¼ˆSï¼‰ã‚’æ¢ã™ï¼ˆä¿å­˜ãŒãªã‘ã‚Œã°ï¼‰
if(!localStorage.getItem('meishiRPG')){
  for(let y=0;y<H;y++)for(let x=0;x<W;x++){
    if(MAP[y][x]==='S'){ state.x=x; state.y=y; }
  }
}
draw();
</script>
</body>
</html>
